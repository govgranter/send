<!DOCTYPE html>
<html>
<head>
    <title>Message Receiver</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        #messageDisplay { border: 2px solid #28a745; padding: 20px; margin: 20px 0; min-height: 100px; 
                         border-radius: 10px; background: #f8f9fa; }
        .status { color: #666; margin: 10px 0; padding: 10px; border-radius: 5px; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .message { font-size: 18px; margin: 15px 0; padding: 10px; background: white; 
                  border-radius: 5px; border-left: 4px solid #007bff; }
        .timestamp { color: #888; font-size: 12px; margin-top: 5px; }
        .loading { color: #17a2b8; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h2>ðŸ“¥ Live Message Receiver (POST Method)</h2>
    <div class="status info">
        âœ… Connected - Listening for new messages...
        <br><small>Using long-polling for instant updates</small>
    </div>
    <div id="messageDisplay">
        <div class="status">No messages yet. Send a message from the sender page!</div>
    </div>

    <script>
        const messageDisplay = document.getElementById('messageDisplay');
        const lastMessageId = 1764524782183; // || 0;

        // Function to fetch new messages using long-polling
        async function fetchMessages() {
            try {
                const response = await fetch(`https://send-39yi.onrender.com/api/messages?lastMessageId=${lastMessageId}`);
                const newMessages = await response.json();

                if (newMessages.length > 0) {
                    displayMessages(newMessages);
                    // Update last message ID
                    savedLastId =
                }
            } catch (error) {
                console.error('Error fetching messages:', error);
            } finally {
                // Immediately poll again
                setTimeout(fetchMessages, 100);
            }
        }
       
        function displayMessages(messages) {
            messages.forEach(message => {
                const time = new Date(message.timestamp).toLocaleTimeString();
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.innerHTML = `
                 ${lastMessageId} ${message.message}
                    <div class="timestamp">Received at: ${time}</div>
                `;
                messageDisplay.appendChild(messageElement);
            });

            // Remove "no messages" placeholder if it exists
            const placeholder = messageDisplay.querySelector('.status');
            if (placeholder && messages.length > 0) {
                placeholder.remove();
            }

            // Scroll to bottom
            messageDisplay.scrollTop = messageDisplay.scrollHeight;
        }
        
        // Start polling when page loads
        window.addEventListener('load', () => {
            // Choose one method:
            fetchMessages(); // Long-polling (more efficient)
        });
    </script>
</body>
</html>
